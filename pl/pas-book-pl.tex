\documentclass{article}
\usepackage[T1]{fontenc}
\usepackage[polish]{babel}
\usepackage[utf8]{inputenc}
\usepackage{hyperref}
\usepackage{geometry}
 \geometry{
 a4paper,
 total={170mm,257mm},
 left=20mm,
 top=20mm,
 }
\usepackage{alltt}
\usepackage{listings} 
\lstset{language=Python, 
        basicstyle=\ttfamily\small, 
        keywordstyle=\color{keywords},
        commentstyle=\color{comments},
        stringstyle=\color{red},
        showstringspaces=false,
        identifierstyle=\color{green},
        keywords=[2]{pow},
        frame = single,
        keywordstyle=[2]{\color{orange}},
} 
\lstnewenvironment{code}{%
  \lstset{backgroundcolor=\color{verbgray},
  frame=single,
  framerule=0pt,
  basicstyle=\ttfamily,
  columns=fullflexible}}{}
\usepackage{pdfpages}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{fancyvrb}
\usepackage{amsfonts}
\usepackage{stmaryrd}
\usepackage{amsmath}
\usepackage{psfrag}
\usepackage{wrapfig}
\usepackage{framed, color}
\definecolor{shadecolor}{rgb}{1., 0.8, 0.3}
\newcommand{\hlc}[2][shadecolor]{ 	{\sethlcolor{#1} \hl{#2}} }
\usepackage{fancyvrb}
\graphicspath{ {./images/} }
\definecolor{keywords}{RGB}{255,0,90}
\definecolor{comments}{RGB}{0,0,113}
\definecolor{red}{RGB}{160,0,0}
\definecolor{green}{RGB}{0,150,0} 
\usepackage{enumitem}
\usepackage{fancyhdr}
\cfoot{Programowanie aplikacji sieciowych, część 1 | Katarzyna Mazur}
\renewcommand{\footrulewidth}{0.4pt}
\fancyfoot[LE,RO]{\thepage}
\pagestyle{fancy}
\setcounter{tocdepth}{4}
\setcounter{secnumdepth}{4}
\usepackage{color,soul}
\definecolor{verbgray}{gray}{0.9}

\title{Programowanie aplikacji sieciowych \\ \small Zbiór zadań, część pierwsza}
%\date{}
\author{Katarzyna Mazur}

\begin{document}

\maketitle
\newpage

\tableofcontents



\newpage 
\section{Zadania wprowadzające}

\begin{enumerate}[label=\textbf{1.\arabic*}]\setlength{\itemsep}{1em}
    \item  Napisz program, w którym pobierzesz od użytkownika nazwę pliku tekstowego w formacie \texttt{*.txt}, a następnie skopiujesz go do pliku pod nazwą \texttt{lab1zad1.txt}. Zadbaj o prawidłową obsługę błędów.
    \item Napisz program, w którym pobierzesz od użytkownika nazwę pliku graficznego w formacie \texttt{*.png}, a następnie skopiujesz go do pliku pod nazwą \texttt{lab1zad2.png}. Zadbaj o prawidłową obsługę błędów.
    \item Napisz program, w którym pobierzesz od użytkownika adres \texttt{IPv4}, a następnie sprawdzisz, czy jest on prawidłowym adresem. Zadbaj o prawidłową obsługę błędów. \textit{Podpowiedź: zadanie możesz rozwiązać przy pomocy wyrażeń regularnych}
    \item Napisz program, w którym pobierzesz od użytkownika adres \texttt{IPv6}, a następnie sprawdzisz, czy jest on prawidłowym adresem.  Zadbaj o prawidłową obsługę błędów. \textit{Podpowiedź: zadanie możesz rozwiązać przy pomocy wyrażeń regularnych}
    \item Napisz program, który jako argument linii poleceń pobierze od użytkownika adres \texttt{IPv4}, a następnie wyświetli odpowiadającą mu nazwę \texttt{hostname} (nazwę domenową). Zadanie rozwiąż bez użycia dodatkowych bibliotek. Zadbaj o prawidłową obsługę błędów.
\end{enumerate}

\newpage 
\section{Analiza pakietów sieciowych}

\begin{enumerate}[label=\textbf{2.\arabic*}]\setlength{\itemsep}{1em}
    \item \label{ex21} Poniżej znajduje się pełny zapis datagramu UDP w postaci szesnastkowej. \\

\begin{figure}[h!t!p!]
\centering
\begin{BVerbatim}
ed 74 0b 55 00 24 ef fd 70 72 6f 67 72 61
6d 6d 69 6e 67 20 69 6e 20 70 79 74 68 6f 
6e 20 69 73 20 66 75 6e
\end{BVerbatim}
\end{figure}

\noindent  Wiedząc, że w zapisie szesnastkowym jedna cyfra reprezentuje $4$ bity, oraz znając strukturę datagramu UDP: 

\begin{figure}[ht!]
\centering
\includegraphics[scale=0.5]{/ch2/udp.jpg}
\end{figure}

\noindent Napisz program, który z powyższego datagramu UDP wydobędzie: 

\begin{itemize}
\item numer źródłowego portu
\item numer docelowego portu
\item dane (ile bajtów w tym pakiecie zajmują dane?)
\end{itemize}

\noindent A następnie uzyskany wynik w postaci: \hlc[shadecolor]{ zad2.1odp;src;X;dst;Y;data;Z } gdzie:

\begin{itemize}
\item X to wydobyty z pakietu numer portu źródłowego
\item Y to wydobyty z pakietu numer portu docelowego
\item Z to wydobyte z pakietu dane 
\end{itemize}

 prześle do serwera UDP działającego na wskazanym porcie pod podanym adresem IPv4, w celu sprawdzenia, czy udało się prawidłowo odczytać wymagane pola. Serwer zwróci odpowiedź \texttt{TAK} lub \texttt{NIE}, a w przypadku błędnego sformatowania wiadomości, odeśle odpowiedź \texttt{BAD\_SYNTAX}.  Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 

 % ####################################################################################################################  
  \item Zmodyfikuj program z zadania \ref{ex21} w taki sposób,  aby łączył się z serwerem posiadającym adres IPv6.  Adres IPv6 serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
 

% ####################################################################################################################  
 \item \label{ex22} Poniżej znajduje się pełny zapis segmentu TCP w postaci szesnastkowej (pole opcji ma 12 bajtów). \\ 

\begin{figure}[h!t!p!]
\centering
\begin{BVerbatim}
0b 54 89 8b 1f 9a 18 ec bb b1 64 f2 80 18
00 e3 67 71 00 00 01 01 08 0a 02 c1 a4 ee 
00 1a 4c ee 68 65 6c 6c 6f 20 3a 29
\end{BVerbatim}
\end{figure}\mbox{}

\noindent  Wiedząc, że w zapisie szesnastkowym jedna cyfra reprezentuje $4$ bity, oraz znając strukturę segmentu TCP:\\

\begin{figure}[ht!]
\centering
\includegraphics[scale=0.45]{./ch2/tcp.png}
\end{figure}
\newpage 
\noindent Napisz program, który z powyższego segmentu TCP wydobędzie: 

\begin{itemize}
\item numer źródłowego portu
\item numer docelowego portu
\item dane (ile bajtów w tym pakiecie zajmują dane?)
\end{itemize}

\noindent A następnie uzyskany wynik w postaci: \hlc[shadecolor]{ zad2.3odp;src;X;dst;Y;data;Z } gdzie:

\begin{itemize}
\item X to wydobyty z pakietu numer portu źródłowego
\item Y to wydobyty z pakietu numer portu docelowego
\item Z to wydobyte z pakietu dane 
\end{itemize}

 prześle do serwera TCP działającego na wskazanym porcie pod podanym adresem IPv4, w celu sprawdzenia, czy udało się prawidłowo odczytać wymagane pola. Serwer zwróci odpowiedź \texttt{TAK} lub \texttt{NIE}, a w przypadku błędnego sformatowania wiadomości, odeśle odpowiedź \texttt{BAD\_SYNTAX}.  Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
% ####################################################################################################################  
 

  \item Zmodyfikuj program z zadania \ref{ex22} w taki sposób,  aby łączył się z serwerem posiadającym adres IPv6.  Adres IPv6 serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 

\end{enumerate}

\newpage
\section{Gniazda klienckie}

%\newpage

\input{python-cli-socket.tex}

\subsection*{Gniazda TCP}

\begin{enumerate}[label=\textbf{3.\arabic*}]\setlength{\itemsep}{1em}
    \item \label{ex31} Napisz program klienta, w którym połączysz się z serwerem na danym porcie przy użyciu protokołu TCP. Adres IPv4 serwera i numer portu pobierz jako argumenty linii poleceń. Wyświetl informację, czy udało się nawiązać połączenie. Program powinien akceptować adres w postaci adresu IPv4 jak i hostname. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
    
    \item Zmodyfikuj program z zadania \ref{ex31} w taki sposób, aby łączył się z serwerem posiadającym adres IPv6.  Adres IPv6 serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
    
    \item \label{ex33} Napisz program klienta (prosty skaner portów sieciowych), który dla danego serwera przy użyciu protokołu TCP będzie sprawdzał, jakie porty są otwarte, a jakie zamknięte. Adres IPv4 serwera pobierz jako argument linii poleceń. Program powinien akceptować adres w postaci adresu IPv4 jak i hostname.  Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
    
    \item  Zmodyfikuj program z zadania \ref{ex33} w taki sposób,  aby łączył się z serwerem posiadającym adres IPv6.  Adres IPv6 serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
    
    \item \label{ex35} Napisz program klienta, który z serwera o podanym adresie IPv4 i porcie pobierze aktualną datę i czas, a następnie wyświetli je na konsoli.  Adres IPv4 serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
    
     \item Zmodyfikuj program z zadania \ref{ex35} w taki sposób,  aby łączył się z serwerem posiadającym adres IPv6.  Adres IPv6 serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
     
     \item \label{ex37} Napisz program klienta, który połączy się z serwerem TCP działającym pod podanym adresem IPv4 na podanym porcie, a następnie wyśle do niego wiadomość i odbierze odpowiedź.  Adres IPv4 serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
     
     \item Zmodyfikuj program z zadania \ref{ex37} w taki sposób,  aby łączył się z serwerem posiadającym adres IPv6.  Adres IPv6 serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
     
     \item \label{ex39} Napisz program klienta, który połączy się z serwerem TCP działającym pod podanym adresem IPv4 na podanym porcie,  a następnie będzie w pętli wysyłał do niego tekst wczytany od użytkownika (jako argument wywołania programu bądź jako dane podawane na konsoli), i odbierał odpowiedzi.  Adres IPv4 serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
     
     \item Zmodyfikuj program z zadania \ref{ex39} w taki sposób,  aby łączył się z serwerem posiadającym adres IPv6.  Adres IPv6 serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 

    \item  \label{ex311} Napisz program klienta (prosty skaner portów sieciowych), który dla danego serwera przy użyciu protokołu TCP będzie sprawdzał, jakie porty są otwarte, a jakie zamknięte. Oprócz informacji o otwartych / zamkniętych portach, program powinien również wyświetlać informację o tym, jaka usługa jest uruchomiona na danym porcie (baner usługi).  Adres IPv4 serwera pobierz jako argument linii poleceń. Program powinien akceptować adres w postaci adresu IPv4 jak i hostname.  Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.  
    
    \item Zmodyfikuj program z zadania \ref{ex311} w taki sposób,  aby łączył się z serwerem posiadającym adres IPv6. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 



% #####################################################################################################################################################

    \item \label{ex313} Napisz program klienta, który połączy się z serwerem TCP działającym pod podanym adresem IPv4 na podanym porcie, a następnie wyśle do niego wiadomość i odbierze odpowiedź. Warunkiem zadania jest, aby klient wysłał i odebrał od serwera wiadomość o maksymalnej długości 20 znaków. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.  Uwzględnij sytuacje, gdy:
    \begin{itemize}
    \item wiadomość do wysłania jest za krótka - ma być wówczas uzupełniania do 20 znaków znakami spacji
    \item wiadomość do wysłania jest za długa - ma być przycięta do 20 znaków (lub wysłana w całości - sprawdź, co się wówczas stanie)
    \end{itemize}
    
% #####################################################################################################################################################    
    
    \item Zmodyfikuj program z zadania \ref{ex313} w taki sposób,  aby łączył się z serwerem posiadającym adres IPv6. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
% #####################################################################################################################################################
    
\item \label{ex315}  W implementacji gniazd, funkcje wysyłania i odbierania danych (np. funkcje \texttt{recv} i \texttt{send} w Pythonie) nie gwarantują wysłania / odbioru wszystkich danych. Rozważmy funkcję \texttt{recv}. Przykładowo, \texttt{100} bajtów może zostać wysłane jako grupa po \texttt{10} bajtów, albo od razu w całości. Oznacza to, iż jeśli używamy gniazd TCP, musimy odbierać dane, dopóki nie mamy pewności, że odebraliśmy odpowiednią ich ilość.

Napisz program klienta, który połączy się z serwerem TCP działającym pod podanym adresem IPv4 na podanym porcie, a następnie wyśle do niego wiadomość i odbierze odpowiedź. Dane odbieraj / wysyłaj w ten sposób, aby mieć pewność, że klient w rzeczywistości odebrał / wysłał wiadomość o wymaganej długości. Prawidłowa komunikacja powinna odbywać się w nastepujacy sposób:

\begin{itemize}
\item Klient wysyła dane do serwera
\item Serwer odsyła klientowi odebrane od niego dane (identyczną wiadomość) 
\end{itemize}

\noindent \textbf{Aby ułatwić sobie zadanie wysyłania i odbierania CAŁEJ wiadomości, możesz każdą z wysłanych / odebranych wiadomości kończyć znakiem nowej linii - \texttt{\textbackslash n}}. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Numer portu TCP, na którym ma działać serwer, pobierz z linii poleceń. Zadbaj o prawidłową obsługę błędów. 
% #####################################################################################################################################################
    
    \item Zmodyfikuj program z zadania \ref{ex315} w taki sposób,  aby łączył się z serwerem posiadającym adres IPv6. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
   
\end{enumerate}

\subsection*{Gniazda UDP}

\begin{enumerate}[label=\textbf{3.\arabic*}, resume]\setlength{\itemsep}{1em}

\item \label{ex317}  Napisz program klienta, który połączy się z serwerem UDP działającym pod podanym adresem IPv4 na podanym porcie, a następnie wyśle do niego wiadomość i odbierze odpowiedź. Adres IPv4 serwera oraz numer portu pobierz jako argumenty linii poleceń. Program powinien akceptować adres w postaci adresu IPv4 jak i hostname.  Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.  

\item  Zmodyfikuj program z zadania \ref{ex317} w taki sposób,  aby łączył się z serwerem posiadającym adres IPv6.  Adres IPv6 serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 

\item \label{ex319} Napisz program klienta, który połączy się z serwerem UDP działającym pod podanym adresem IPv4 na podanym porcie,  a następnie będzie w pętli wysyłał do niego tekst wczytany od użytkownika, i odbierał odpowiedzi.    Adres IPv4 serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 

\item  Zmodyfikuj program z zadania \ref{ex319} w taki sposób,  aby łączył się z serwerem posiadającym adres IPv6. Adres IPv6 serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 

\item \label{ex321} Napisz program klienta, który połączy się z serwerem UDP działającym pod podanym adresem IPv4 na podanym porcie, a następnie prześle do serwera liczbę, operator, liczbę (pobrane od użytkownika) i odbierze odpowiedź. Adres IPv4 serwera i numer portu pobierz jako argumenty linii poleceń.  Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 

\item  Zmodyfikuj program z zadania \ref{ex321} w taki sposób,  aby łączył się z serwerem posiadającym adres IPv6. Adres IPv6 serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 

\item \label{ex322} Napisz program klienta, który połączy się z serwerem UDP działającym pod podanym adresem IPv4 na podanym porcie, a następnie prześle do serwera pobrany z linii poleceń adres IP, i odbierze odpowiadającą mu nazwę hostname. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 

\item  Zmodyfikuj program z zadania \ref{ex322} w taki sposób,  aby łączył się z serwerem posiadającym adres IPv6. Adres IPv6 serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 

\item \label{ex323} Napisz program klienta, który połączy się z serwerem UDP działającym pod podanym adresem IPv4 na podanym porcie, a następnie prześle do serwera nazwę hostname pobraną z linii poleceń, i odbierze odpowiadający mu adres IP.  Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 

\item Zmodyfikuj program z zadania \ref{ex323} w taki sposób,  aby łączył się z serwerem posiadającym adres IPv6. Adres IPv6 serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
\end{enumerate}


\newpage
\section{Gniazda serwerowe}

\input{python-serv-socket.tex}
\newpage

\noindent \textbf{\underline{Uwaga:}} W poniższych zadaniach zakładamy, iż serwer powinien obsługiwać tylko jednego klienta w danej chwili.

\subsection*{Gniazda TCP}

\begin{enumerate}[label=\textbf{4.\arabic*}]\setlength{\itemsep}{1em}

\item \label{ex41} Napisz program serwera, który działając pod adresem IPv4 oraz na podanym porcie TCP, dla podłączającego się klienta, będzie odsyłał mu aktualny czas oraz datę. Prawidłowa komunikacja powinna odbywać się w nastepujacy sposób: 

\begin{itemize}
\item Serwer odbiera od klienta wiadomość (dowolną)
\item Serwer odsyła klientowi aktualną datę i czas
\end{itemize}

\noindent Po zakończeniu obsługi klienta, serwer powinien nieprzerwanie oczekiwać na kolejnych klientów, których będzie mógł obsłużyć. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Numer portu TCP, na którym ma działać serwer, pobierz z linii poleceń. Zadbaj o prawidłową obsługę błędów. 

% ############################################################################################################
\item Zmodyfikuj program z zadania \ref{ex41} w taki sposób,  aby serwer działał pod adresem IPv6. Po zakończeniu obsługi klienta, serwer powinien nieprzerwanie oczekiwać na kolejnych klientów, których będzie mógł obsłużyć. Numer portu TCP pobierz jako argument linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
% ############################################################################################################

\item \label{ex42} Napisz program serwera, który działając  pod adresem IPv4 oraz na podanym porcie TCP, dla podłączającego się klienta, będzie odsyłał mu przesłaną wiadomość (tzw. serwer echa). Prawidłowa komunikacja powinna odbywać się w nastepujacy sposób:

\begin{itemize}
\item Serwer odbiera dane od klienta
\item Serwer odsyła klientowi odebrane od niego dane (identyczną wiadomość) 
\end{itemize}

\noindent Po zakończeniu obsługi klienta, serwer powinien nieprzerwanie oczekiwać na kolejnych klientów, których będzie mógł obsłużyć. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Numer portu TCP, na którym ma działać serwer, pobierz z linii poleceń. Zadbaj o prawidłową obsługę błędów. 
% ############################################################################################################

\item Zmodyfikuj program z zadania \ref{ex42} w taki sposób,  aby serwer działał pod adresem IPv6. Po zakończeniu obsługi klienta, serwer powinien nieprzerwanie oczekiwać na kolejnych klientów, których będzie mógł obsłużyć. Numer portu TCP pobierz jako argument linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
% ############################################################################################################

\item \label{ex45} Napisz program serwera, który działając  pod adresem IPv4 oraz na podanym porcie TCP, będzie losował liczbę i odbierał od klienta wiadomości. W przypadku, gdy w wiadomości klient przyśle do serwera coś innego, niż liczbę, serwer powinien poinformować klienta o błędzie. Po odebraniu liczby od klienta, serwer sprawdza, czy otrzymana liczba jest:

\begin{itemize}
\item mniejsza od wylosowanej przez serwer
\item równa wylosowanej przez serwer
\item większa od wylosowanej przez serwer
\end{itemize} 

\noindent A następnie odsyła stosowną informację do klienta. W przypadku, gdy klient odgadnie liczbę, serwer powinien zakończyć działanie.   Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Numer portu TCP, na którym ma działać serwer, pobierz z linii poleceń. Zadbaj o prawidłową obsługę błędów. 

% ############################################################################################################
\item Zmodyfikuj program z zadania \ref{ex45} w taki sposób,  aby serwer działał pod adresem IPv6.   Numer portu TCP pobierz jako argument linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.

% ############################################################################################################

\item \label{ex47} Napisz program serwera, który działając  pod adresem IPv4 oraz na podanym porcie TCP, będzie odsyłał klientowi jego wiadomość (o maksymalnej długości 20 znaków) (tzw. serwer echa).  Uwzględnij sytuacje, gdy:

\begin{itemize}
\item wiadomość do wysłania jest za krótka - ma być wówczas uzupełniania do 20 znaków znakami spacji
\item wiadomość do wysłania jest za długa - ma być przycięta do 20 znaków (lub wysłana w całości - sprawdź, co się wówczas stanie)
\end{itemize}

\noindent Numer portu TCP pobierz jako argument linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.

% ############################################################################################################
\item Zmodyfikuj program z zadania \ref{ex47} w taki sposób,  aby serwer działał pod adresem IPv6.   Numer portu TCP pobierz jako argument linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.

% ############################################################################################################

\item  \label{ex49} W implementacji gniazd, funkcje wysyłania i odbierania danych (np. funkcje \texttt{recv} i \texttt{send} w Pythonie) nie gwarantują wysłania / odbioru wszystkich danych. Rozważmy funkcję \texttt{recv}. Przykładowo, \texttt{100} bajtów może zostać wysłane jako grupa po \texttt{10} bajtów, albo od razu w całości. Oznacza to, iż jeśli używamy gniazd TCP, musimy odbierać dane, dopóki nie mamy pewności, że odebraliśmy odpowiednią ich ilość.

Napisz program serwera, który działając  pod adresem IPv4 oraz na podanym porcie TCP, dla podłączającego się klienta, będzie odsyłał mu przesłaną wiadomość (tzw. serwer echa). Prawidłowa komunikacja powinna odbywać się w nastepujacy sposób:

\begin{itemize}
\item Serwer odbiera dane od klienta
\item Serwer odsyła klientowi odebrane od niego dane (identyczną wiadomość) 
\end{itemize}

\noindent \textbf{Aby ułatwić sobie zadanie wysyłania i odbierania CAŁEJ wiadomości, możesz każdą z wysłanych / odebranych wiadomości kończyć znakiem nowej linii - \texttt{\textbackslash n}}. Po zakończeniu obsługi klienta, serwer powinien nieprzerwanie oczekiwać na kolejnych klientów, których będzie mógł obsłużyć. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Numer portu TCP, na którym ma działać serwer, pobierz z linii poleceń. Zadbaj o prawidłową obsługę błędów. 

% ############################################################################################################
\item Zmodyfikuj program z zadania \ref{ex49} w taki sposób,  aby serwer działał pod adresem IPv6.   Numer portu TCP pobierz jako argument linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.
% ############################################################################################################
\end{enumerate}

\subsection*{Gniazda UDP}

\begin{enumerate}[label=\textbf{4.\arabic*}, resume]\setlength{\itemsep}{1em}

\item  \label{ex411} Napisz program serwera, który działając  pod adresem IPv4 oraz na podanym porcie UDP, dla podłączającego się klienta, będzie odsyłał mu przesłaną wiadomość (tzw. serwer echa). Prawidłowa komunikacja powinna odbywać się w nastepujacy sposób:

\begin{itemize}
\item Serwer odbiera dane od klienta
\item Serwer odsyła klientowi odebrane od niego dane (identyczną wiadomość) 
\end{itemize}

\noindent Po zakończeniu obsługi klienta, serwer powinien nieprzerwanie oczekiwać na kolejnych klientów, których będzie mógł obsłużyć. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Numer portu UDP, na którym ma działać serwer, pobierz z linii poleceń. Zadbaj o prawidłową obsługę błędów. 
% ############################################################################################################
\item Zmodyfikuj program z zadania \ref{ex411} w taki sposób,  aby serwer działał pod adresem IPv6.   Numer portu UDP pobierz jako argument linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.
% ############################################################################################################
\item \label{ex413} Napisz program serwera, który działając  pod adresem IPv4 oraz na podanym porcie UDP, dla podłączającego się klienta, będzie odbierał od niego liczbę, operator i liczbę, a następnie odsyłał klientowi wynik działania przez niego przesłanego. Komunikacja powinna wyglądać w następujący sposób:

\begin{itemize}
\item Klient łączy się do serwera
\item Klient przesyła do serwera pierwszą liczbę
\item Serwer odsyła klientowi tekst \texttt{OK}
\item Klient wysyła znak działania do serwera (dla uproszczenia, dozwolone są jedynie operacje \texttt{+} \texttt{-} \texttt{*} \texttt{/})
\item Serwer odsyła klientowi tekst \texttt{OK}
\item Klient przesyła do serwera drugą liczbę
\item Serwer odsyła klientowi wynik działania
\end{itemize}

\noindent Po zakończeniu obsługi klienta, serwer powinien nieprzerwanie oczekiwać na kolejnych klientów, których będzie mógł obsłużyć. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Numer portu UDP, na którym ma działać serwer, pobierz z linii poleceń. Zadbaj o prawidłową obsługę błędów. 
% ############################################################################################################
\item  Zmodyfikuj program z zadania \ref{ex413} w taki sposób,  aby serwer działał pod adresem IPv6.   Numer portu UDP pobierz jako argument linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.

% ############################################################################################################


\end{enumerate}


\newpage
\section{Bezpiecznie gniazda}

\newpage
\section{Protokoły pocztowe}

\subsection*{Protokół SMTP}

\begin{enumerate}[label=\textbf{6.\arabic*}]\setlength{\itemsep}{1em}

\item Pod podanym adresem i numerem portu działa serwer obsługujący protokół ESMTP/SMTP. Wykorzystując gotowe oprogramowanie klienckie połącz się z serwerem działajacym pod podanym adresem i numerem portu, a następnie wyślij wiadomość e-mail korzytając z komend protokołu ESMTP.  (\textit{Zadanie nie jest zadaniem programistycznym, wymaga jedynie użycia gotowego klienta protokołu SMTP w celu zapoznania się z podstawowymi poleceniami protokołu.})

\item Pod podanym adresem i numerem portu działa serwer obsługujący protokół ESMTP/SMTP. Wykorzystując gotowe oprogramowanie klienckie połącz się z serwerem działajacym pod podanym adresem i numerem portu, a następnie wyślij kilka wiadomości e-mail do kilku odbiorców korzytając z komend protokołu ESMTP.  (\textit{Zadanie nie jest zadaniem programistycznym, wymaga jedynie użycia gotowego klienta protokołu SMTP w celu zapoznania się z podstawowymi poleceniami protokołu.})

\item Pod podanym adresem i numerem portu działa serwer obsługujący protokół ESMTP/SMTP. Wykorzystując gotowe oprogramowanie klienckie połącz się z serwerem działajacym pod podanym adresem i numerem portu, a następnie wyślij wiadomość spoofed e-mail (z podmienionym adresem nadawcy) korzytając z komend protokołu ESMTP.  (\textit{Zadanie nie jest zadaniem programistycznym, wymaga jedynie użycia gotowego klienta protokołu SMTP w celu zapoznania się z podstawowymi poleceniami protokołu.})

\item Pod podanym adresem i numerem portu działa serwer obsługujący protokół ESMTP/SMTP. Wykorzystując gotowe oprogramowanie klienckie połącz się z serwerem działajacym pod podanym adresem i numerem portu, a następnie wyślij wiadomość e-mail korzytając z komend protokołu ESMTP.  Do wiadomości dodaj załącznik - dowolny plik tekstowy (sprawdź format MIME: \href{https://www.w3.org/Protocols/rfc1341/7_2_Multipart.html}{Multipart} i \href{https://www.w3.org/Protocols/rfc1341/7_3_Message.html}{Content-Type}).  Możesz wykorzystać \texttt{openssl} do przekonwertowania pliku: \texttt{cat plik.txt \textbar  openssl base64}.  (\textit{Zadanie nie jest zadaniem programistycznym, wymaga jedynie użycia gotowego klienta protokołu SMTP w celu zapoznania się z podstawowymi poleceniami protokołu.})

\item Pod podanym adresem i numerem portu działa serwer obsługujący protokół ESMTP/SMTP. Wykorzystując gotowe oprogramowanie klienckie połącz się z serwerem działajacym pod podanym adresem i numerem portu, a następnie wyślij wiadomość e-mail korzytając z komend protokołu ESMTP. Do wiadomości dodaj załącznik - dowolny obrazek (sprawdź format MIME: \href{https://www.w3.org/Protocols/rfc1341/7_2_Multipart.html}{Multipart} i \href{https://www.w3.org/Protocols/rfc1341/7_3_Message.html}{Content-Type}). Możesz wykorzystać \texttt{openssl} do przekonwertowania obrazka: \texttt{cat obrazek \textbar  openssl base64}. (\textit{Zadanie nie jest zadaniem programistycznym, wymaga jedynie użycia gotowego klienta protokołu SMTP w celu zapoznania się z podstawowymi poleceniami protokołu.})

\item Napisz program klienta, który połączy się z serwerem obsługującym protokół ESMTP/SMTP, działającym  na podanym porcie, a następnie wyśle wiadomość e-mail używając komend protokołu ESMTP. O adres nadawcy, odbiorcy (odbiorców), temat wiadomości i jej treść zapytaj użytkownika. Adres serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 

\item Napisz program klienta, który połączy się z serwerem obsługującym protokół ESMTP/SMTP, działającym  na podanym porcie, a następnie wyśle wiadomość e-mail używając komend protokołu ESMTP.  Do wiadomości dodaj załącznik - dowolny plik tekstowy (sprawdź format MIME: \href{https://www.w3.org/Protocols/rfc1341/7_2_Multipart.html}{Multipart} i \href{https://www.w3.org/Protocols/rfc1341/7_3_Message.html}{Content-Type}).  O adres nadawcy, odbiorcy (odbiorców), temat wiadomości i jej treść zapytaj użytkownika. Adres serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 

\item Napisz program klienta, który połączy się z serwerem obsługującym protokół ESMTP/SMTP, działającym  na podanym porcie, a następnie wyśle wiadomość e-mail używając komend protokołu ESMTP.  Do wiadomości dodaj załącznik - dowolny obrazek (sprawdź format MIME: \href{https://www.w3.org/Protocols/rfc1341/7_2_Multipart.html}{Multipart} i \href{https://www.w3.org/Protocols/rfc1341/7_3_Message.html}{Content-Type}).  O adres nadawcy, odbiorcy (odbiorców), temat wiadomości i jej treść zapytaj użytkownika. Adres serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.

\item Napisz program klienta, który połączy się z serwerem obsługującym protokół ESMTP/SMTP, działającym  na podanym porcie, a następnie wyśle wiadomość e-mail używając komend protokołu ESMTP.  Do wiadomości dodaj załącznik - dowolny plik dźwiękowy. (sprawdź format MIME: \href{https://www.w3.org/Protocols/rfc1341/7_2_Multipart.html}{Multipart} i \href{https://www.w3.org/Protocols/rfc1341/7_3_Message.html}{Content-Type}).  O adres nadawcy, odbiorcy (odbiorców), temat wiadomości i jej treść zapytaj użytkownika. Adres serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.

\item Napisz program klienta, który połączy się z serwerem obsługującym protokół ESMTP/SMTP, działającym  na podanym porcie, a następnie wyśle wiadomość e-mail używając komend protokołu ESMTP. Treść wiadomości powinna zostać sformatowana za pomocą tagów HTML, przykładowo: \texttt{<b>}\textbf{pogrubienie}\texttt{</b>}, \texttt{<i>}\textit{pochylenie}\texttt{</i>}, \texttt{<u>}\underline{podkreślenie}\texttt{</u>} i innych wybranych.   O adres nadawcy, odbiorcy (odbiorców), temat wiadomości i jej treść zapytaj użytkownika. Adres serwera i numer portu pobierz jako argumenty linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.

\item  \label{ex611} Napisz program serwera, który działając pod adresem IPv4 \texttt{127.0.0.1} oraz na określonym porcie TCP, będzie serwerem poczty, obsługującym protokół SMTP. Nie realizuj faktycznego wysyłania e-maila, tylko zasymuluj jego działanie tak, żeby napisany wcześniej klient SMTP myślał, że wiadomość została wysłana. Pamiętaj o obsłudze przypadku, gdy klient poda nie zaimplementowaną przez serwer komendę. Numer portu pobierz jako argument linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.

\item  Zmodyfikuj program z zadania \ref{ex611} w taki sposób,  aby łączył serwer działał pod adresem IPv6 - \texttt{::1}. Numer portu pobierz jako argument linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 

\end{enumerate}

\newpage
\subsection*{Protokół POP3}

\newpage 
\subsection*{Protokół IMAP}

\newpage 
\section{Protokół HTTP (w wersji 1.1)}

%\subsection*{Protokół HTTP }

\input{ch7_http.tex}
\newpage

\begin{enumerate}[label=\textbf{7.\arabic*}]\setlength{\itemsep}{1em}

\item Korzystając z przygotowanego obrazu Dockerowego (\texttt{mazurkatarzyna/pas-book-p1-ch7-ex1:latest}), uruchom serwer HTTP. Po uruchomieniu obrazu, pod adresem IPv4 \texttt{127.0.0.1} na porcie TCP o numerze \texttt{7001} działa serwer obsługujący protokół HTTP w wersji 1.1. Pod odnośnikiem \texttt{/html} udostępnia prostą stronę HTML. Napisz program klienta, który połączy się
z serwerem, a następnie pobierze treść strony i zapisze ją na dysku jako plik z rozszerzeniem \texttt{*.html}. Spreparuj żądanie HTTP tak, aby serwer myślał, że żądanie przyszło od przeglądarki \texttt{Safari 7.0.3}. Jakich nagłówków HTTP należy użyć?  Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.
% #################################################################################################################

\item Korzystając z przygotowanego obrazu Dockerowego (\texttt{mazurkatarzyna/pas-book-p1-ch7-ex2:latest}), uruchom serwer HTTP. Po uruchomieniu obrazu, pod adresem IPv4 \texttt{127.0.0.1} na porcie TCP o numerze \texttt{7002} działa serwer obsługujący protokół HTTP w wersji 1.1. Pod odnośnikiem \texttt{/image/png} udostępnia obrazek. Napisz program klienta, który połączy się
z serwerem, a następnie pobierze obrazek i zapisze go na dysku. Jakich nagłówków HTTP należy użyć? Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.
% #################################################################################################################

\item Korzystając z przygotowanego obrazu Dockerowego (\texttt{mazurkatarzyna/pas-book-p1-ch7-ex3:latest}), uruchom serwer HTTP.  Po uruchomieniu obrazu, pod adresem IPv4 \texttt{127.0.0.1} na porcie TCP o numerze \texttt{7003} działa serwer obsługujący protokół HTTP w wersji 1.1. Pod odnośnikiem \texttt{/image.jpg} udostępnia obrazek. Napisz program klienta, który połączy się
z serwerem, a następnie pobierze z serwera obrazek w 3 częściach i po odebraniu wszystkich części złoży go w całość i zapisze na dysku. Jakich nagłówków HTTP należy użyć? Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.

% #################################################################################################################

\item  Korzystając z przygotowanego obrazu Dockerowego (\texttt{mazurkatarzyna/pas-book-p1-ch7-ex4:latest}), uruchom serwer HTTP.  Po uruchomieniu obrazu, pod adresem IPv4 \texttt{127.0.0.1} na porcie TCP o numerze \texttt{7004} działa serwer obsługujący protokół HTTP w wersji 1.1. Pod odnośnikiem \texttt{/post} udostępnia formularz z polami do wypełnienia. Napisz program klienta, który połączy się z serwerem, a następnie uzupełni formularz danymi pobranymi od użytkownika, a następnie prześle go do serwera i odbierze odpowiedź. \\

Aby sprawdzić, jak wygląda żądanie HTTP potrzebne do wypełnienia i wysłania formularza:

\begin{itemize}
\item jakie \href{https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html}{\textit{nagłówki HTTP}} są wykorzystywane,
\item jak wygląda ciało zapytania,
\end{itemize}

podsłuchaj komunikację z serwerem za pomocą Wiresharka, tj. uruchom przeglądarkę oraz Wiresharka; uzupełnij i zatwierdź formularz ręcznie za pomocą przeglądarki, a następnie sprawdź pakiety podsłuchane podczas komunikacji z serwerem działającym pod adresem \texttt{http://127.0.0.1:7004}. Możesz użyć filtrów Wiresharka: \texttt{http.request} oraz \texttt{http.response} (\texttt{http.request $\vert\vert$ http.response}). Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.

% #################################################################################################################

\item \textbf{Slowloris, czyli Slow HTTP Headers DoS} Attak o nazwie Slowloris, dzięki wykorzystaniu pewnych koncepcji protokołu HTTP oraz sposobu obsługi żądań serwerów WWW, potrafi całkowicie je sparaliżować w przeciągu kilku sekund. Atak polega na utworzeniu dużej liczby gniazd, a następnie dosyłania w powolny sposób danych częściowych żądań HTTP, co w końcu skutkuje wyczerpaniem puli wolnych wątków obsługujących żądania HTTP.\\

\noindent W klasycznym żądaniu, np. wykorzystującym metodę \texttt{HTTP GET}, do serwera wysyłana jest linia żądania, nagłówki oraz pusta linia CRLF oznaczająca koniec nagłówków. Atak Slowloris polega na wysyłaniu dużej liczby dodatkowych nagłówków, przykładowo \texttt{X-a:} \texttt{b}, które będą sukcesywnie przychodzić do atakowanego serwera dopiero po pewnym czasie.  Podsumowując, atak działa następująco: \newpage

\begin{enumerate}  
\item Budowane są gniazda TCP (im więcej, tym lepiej, domyślnie ~ 1000)\\ 
\texttt{sock = socket(AF\_INET, SOCK\_STREAM)}
\item Następuje podłączenie do serwera i wysyłanie podstawowych nagłówków\\
\texttt{sock.connect(server)}, \texttt{sock.send('...')},
\item Wysyłany jest nagłówek \texttt{X-a: b \textbackslash r\textbackslash n} \\
\texttt{sock.send('...')}
\item Odczekujemy pewien czas (domyślnie 100 sekund)\\
\texttt{time.sleep(100)}
\item Wysyłamy ponownie nagłówek \texttt{X-a: b \textbackslash r\textbackslash n}\\
\texttt{sock.send('...')}
\item Powtarzamy do skutku kroki 4. i 5. dla każdego połączenia, ewentualnie dobudowujemy gniazda do zamkniętych połączeń
\end{enumerate} 

\noindent Korzystając z przygotowanego obrazu Dockerowego (\texttt{mazurkatarzyna/pas-book-p1-ch7-ex5:latest}), uruchom serwer HTTP.  Po uruchomieniu obrazu, pod adresem IPv4 \texttt{127.0.0.1} na porcie TCP o numerze \texttt{7005} działa serwer obsługujący protokół HTTP w wersji 1.1.  Znając założenia ataku Slowloris, napisz program klienta - atakującego, który wykona atak Slowloris  na serwer WWW.  Jakich nagłówków HTTP należy użyć? Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.
% #################################################################################################################

\item  Korzystając z przygotowanego obrazu Dockerowego (\texttt{mazurkatarzyna/pas-book-p1-ch7-ex6:latest}), uruchom serwer HTTP.  Po uruchomieniu obrazu, pod adresem IPv4 \texttt{127.0.0.1} na porcie TCP o numerze \texttt{7006} działa serwer obsługujący protokół HTTP w wersji 1.1. Serwer udostępnia różne wersje językowe swojej strony głównej. Wykorzystując nagłówki protokołu HTTP, napisz program klienta, który połączy się z serwerem, a następnie pobierze niemiecką wersję strony głównej. Jakich nagłówków HTTP należy użyć? Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.

% #################################################################################################################

\item Korzystając z przygotowanego obrazu Dockerowego (\texttt{mazurkatarzyna/pas-book-p1-ch7-ex3:latest}), uruchom serwer HTTP.  Po uruchomieniu obrazu, pod adresem IPv4 \texttt{127.0.0.1} na porcie TCP o numerze \texttt{7003} działa serwer obsługujący protokół HTTP w wersji 1.1. Pod odnośnikiem \texttt{/image.jpg} udostępnia obrazek. Napisz program klienta, który połączy się
z serwerem, a następnie pobierze z serwera obrazek w 3 częściach i po odebraniu wszystkich części złoży go w całość i zapisze na dysku. \textbf{Następnie zmodyfikuj program   w taki sposób, aby pobierał z serwera obrazek tylko wtedy, gdy nie zmienił się on od ostatniego pobrania}. Jakich nagłówków HTTP należy użyć? Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.

% #################################################################################################################

\item \label{ex78} Napisz program serwera, który działając pod podanym adresem IPv4   oraz na określonym porcie TCP, będzie serwerem HTTP. Obsłuż wybrane nagłówki i co najmniej jeden kod błędu (np. 404).  Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.

% #################################################################################################################

\item  Zmodyfikuj program z zadania \ref{ex78} w taki sposób, aby serwer wykorzystywał adres IPv6.  Numer portu pobierz jako argument  linii poleceń. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. 
% #################################################################################################################    

\item Poniżej znajduje się request protokołu HTTP/1.1 w zapisie szesnastkowym. Wiedząc, że znak \texttt{\textbackslash r} w zapisie szesnastkowym to \texttt{0x0d}, natomiast \texttt{\textbackslash n} to \texttt{0x0a} oraz wiedząc, że w zapisie szesnastkowym jedna cyfra reprezentuje $4$ bity, napisz program, w którym sprawdzisz, jakie nagłówki zostały wysłane do serwera.

\begin{figure}[h!t!p!]
\centering
\begin{BVerbatim}
47 45 54 20 2f 20 48 54  54 50 2f 31 2e 31 0d 0a   
20 48 6f 73 74 3a 20 77  77 77 2e 75 6d 63 73 2e   
70 6c 20 0d 0a 20 55 73  65 72 2d 41 67 65 6e 74   
3a 20 63 75 72 6c 2f 37  2e 38 31 2e 30 20 0d 0a  
20 41 63 63 65 70 74 3a  20 2a 2f 2a 20 0d 0a 0d   
0a
\end{BVerbatim}
\end{figure}
% #################################################################################################################    

% curl -X GET htts://umcs.pl 
% echo -ne "GET / HTTP/1.1\r\n Host: www.umcs.pl \r\n User-Agent: curl/7.81.0 \r\n Accept: */* \r\n\r\n" | hexdump -C

% \item Wiedząc, że serwer na żądanie typu GET zwraca parametry żądania, wyślij do niego request, na który serwer odpowie odsyłając jedynie parametry wysłanego żądanie. Zadanie możesz rozwiązać za pomocą \texttt{curla} lub skryptu w Pythonie. 


\item \label{ex711} Korzystając z przygotowanego obrazu Dockerowego (\texttt{mazurkatarzyna/pas-book-p1-ch7-ex11:latest}), uruchom serwer HTTP.  Po uruchomieniu obrazu, pod adresem IPv4 \texttt{127.0.0.1} na porcie TCP o numerze \texttt{7011} działa serwer obsługujący protokół HTTP w wersji 1.1. Serwer w odpowiedzi na żądanie typu \texttt{GET} zwraca parametry żądania. Napisz program klienta, który połączy się z serwerem, a następnie wyśle do serwera żądanie \texttt{GET} z parametrem \texttt{key}, który dostaje wartość \texttt{value}, odbierze i wyświetli odpowiedź.  Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.
% Działanie serwera możesz przetesotwać otwierając w przeglądarce strone: \url{http://127.0.0.1:7011/?key=value}
% #################################################################################################################    

\item Spróbuj rozwiązać zadanie \ref{ex711} za pomocą narzędzia \texttt{curl}. 
% curl -GET "http://127.0.0.1:8080?key=value"
% curl -GET "http://127.0.0.1:8080" -d "key=please"

% nc 127.0.0.1 8080
% GET /?key=value HTTP/1.1
% Host: 127.0.0.1

% #################################################################################################################    

\item \label{ex713}  Korzystając z przygotowanego obrazu Dockerowego (\texttt{mazurkatarzyna/pas-book-p1-ch7-ex13:latest}), uruchom serwer HTTP.  Po uruchomieniu obrazu, pod adresem IPv4 \texttt{127.0.0.1} na porcie TCP o numerze \texttt{7013} działa serwer obsługujący protokół HTTP w wersji 1.1. Serwer w odpowiedzi na odebrany request, odsyła do klienta przesłane przez niego ciasteczko (\texttt{cookie header}). W przypadku, gdy klient nie prześle ciasteczka, serwer zwraca odpowiedź z kodem \texttt{404}. Napisz program klienta, który połączy się z serwerem, a następnie wyśle do serwera ciasteczko z kluczem \texttt{key} oraz wartością \texttt{value}, a następnie odbierze i wyświetli odpowiedź.  Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.

% GET / HTTP/1.1
% Host: 127.0.0.1
% cookie: key=value
% #################################################################################################################    
\item Spróbuj rozwiązać zadanie \ref{ex713} za pomocą narzędzia \texttt{curl}.  
% curl -GET "http://127.0.0.1:8080" --cookie "key=please"

% #################################################################################################################    
\item \label{ex715} Korzystając z przygotowanego obrazu Dockerowego (\texttt{mazurkatarzyna/pas-book-p1-ch7-ex11:latest}), uruchom serwer HTTP.  Po uruchomieniu obrazu, pod adresem IPv4 \texttt{127.0.0.1} na porcie TCP o numerze \texttt{7011} działa serwer obsługujący protokół HTTP w wersji 1.1. Serwer w odpowiedzi na żądanie typu \texttt{GET} zwraca parametry żądania. Napisz program klienta, który połączy się z serwerem, a następnie wyśle do serwera żądanie \texttt{GET} z parametrem \texttt{key}, który dostaje wartość \texttt{value}, odbierze i wyświetli odpowiedź. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. \textbf{Uwaga: wyślij do serwera 2 parametry \texttt{key} z wartością \texttt{value}.} 

% curl -X GET "http://127.0.0.1?key=please&key=please"
% curl -GET "http://ptl-6978b5c46e5c-993fe3572838.libcurl.me/pentesterlab?key=please&key=please"
% #################################################################################################################    
\item Spróbuj rozwiązać zadanie \ref{ex715} za pomocą narzędzia \texttt{curl}.  
% ################################################################################################################# 
\item \label{ex717} Korzystając z przygotowanego obrazu Dockerowego (\texttt{mazurkatarzyna/pas-book-p1-ch7-ex11:latest}), uruchom serwer HTTP.  Po uruchomieniu obrazu, pod adresem IPv4 \texttt{127.0.0.1} na porcie TCP o numerze \texttt{7011} działa serwer obsługujący protokół HTTP w wersji 1.1. Serwer w odpowiedzi na żądanie typu \texttt{GET} zwraca parametry żądania. Napisz program klienta, który połączy się z serwerem, a następnie wyśle do serwera żądanie \texttt{GET} z parametrem \texttt{key}, który dostaje wartość \texttt{value\&}, odbierze i wyświetli odpowiedź. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. \textbf{Uwaga: zwróć szczególną uwagę, czy serwer zwróci odpowiednią wartość parametru, czyli \texttt{value\&} zamiast \texttt{value}.} \

% https://www.w3schools.com/tags/ref_urlencode.ASP

% Przeglądarki internetowe żądają stron z serwerów sieciowych za pomocą adresu URL. Adres URL to adres strony internetowej, na przykład: https://www.umcs.pl . Kodowanie adresów URL (URL Encoding or Percent Encoding) konwertuje znaki na format, który można przesyłać przez Internet. Adresy URL można przesyłać przez Internet tylko przy użyciu zestawu znaków ASCII. Ponieważ adresy URL często zawierają znaki spoza zestawu ASCII, adres URL musi zostać przekonwertowany na prawidłowy format ASCII. Kodowanie adresu URL zastępuje niebezpieczne znaki ASCII znakiem \texttt{\%}, po którym następują dwie cyfry szesnastkowe. Adresy URL nie mogą zawierać spacji. Kodowanie adresów URL zwykle zastępuje spację znakiem plus \texttt{+} lub \texttt{\%20}.

% Możesz skorzystać z narzędzia \texttt{ascii} (\texttt{man ascii}) dostępnego w systemie Linux. Sprawdź, w jaki sposób w zapisie szesnastkowym można zakodować znak \texttt{\&}.
% ################################################################################################################# 
\item Spróbuj rozwiązać zadanie \ref{ex717} za pomocą narzędzia \texttt{curl}.  
% curl -GET "http://127.0.0.1:8080?key=please%26"
% ################################################################################################################# 
\item \label{ex719} Korzystając z przygotowanego obrazu Dockerowego (\texttt{mazurkatarzyna/pas-book-p1-ch7-ex19:latest}), uruchom serwer HTTP.  Po uruchomieniu obrazu, pod adresem IPv4 \texttt{127.0.0.1} na porcie TCP o numerze \texttt{7019} działa serwer obsługujący protokół HTTP w wersji 1.1. Serwer w odpowiedzi na żądanie typu \texttt{GET} zwraca parametry żądania. Napisz program klienta, który połączy się z serwerem, a następnie wyśle do serwera żądanie \texttt{GET} z parametrem \texttt{?key}, który dostaje wartość \texttt{value}, odbierze i wyświetli odpowiedź. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. \textbf{Uwaga: zwróć szczególną uwagę, czy serwer zwróci odpowiedni parametr, czyli \texttt{?key}.} \
% ################################################################################################################# 
\item Spróbuj rozwiązać zadanie \ref{ex719} za pomocą narzędzia \texttt{curl}.  
% ################################################################################################################# 
\newpage 
\item \label{ex721} Korzystając z przygotowanego obrazu Dockerowego (\texttt{mazurkatarzyna/pas-book-p1-ch7-ex11:latest}), uruchom serwer HTTP.  Po uruchomieniu obrazu, pod adresem IPv4 \texttt{127.0.0.1} na porcie TCP o numerze \texttt{7011} działa serwer obsługujący protokół HTTP w wersji 1.1. Serwer w odpowiedzi na żądanie typu \texttt{GET} zwraca parametry żądania. Napisz program klienta, który połączy się z serwerem, a następnie wyśle do serwera żądanie \texttt{GET} z parametrem \texttt{key}, który dostaje wartość \texttt{imie nazwisko}, odbierze i wyświetli odpowiedź. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. \textbf{Uwaga: zwróć szczególną uwagę, czy serwer zwróci odpowiednią wartość parametru \texttt{key}, czyli \texttt{imie nazwisko}.} \
% data = "GET /?key=please%20me HTTP/1.1\r\nHost: 127.0.0.1\r\n\r\n"
% ################################################################################################################# 
\item Spróbuj rozwiązać zadanie \ref{ex721} za pomocą narzędzia \texttt{curl}.  
% ################################################################################################################# 
\item \label{ex723} Korzystając z przygotowanego obrazu Dockerowego (\texttt{mazurkatarzyna/pas-book-p1-ch7-ex11:latest}), uruchom serwer HTTP.  Po uruchomieniu obrazu, pod adresem IPv4 \texttt{127.0.0.1} na porcie TCP o numerze \texttt{7011} działa serwer obsługujący protokół HTTP w wersji 1.1. Serwer w odpowiedzi na żądanie typu \texttt{GET} zwraca parametry żądania. Napisz program klienta, który połączy się z serwerem, a następnie wyśle do serwera żądanie \texttt{GET} z parametrem \texttt{key}, który dostaje wartość \texttt{value\#}, odbierze i wyświetli odpowiedź. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów. \textbf{Uwaga: zwróć szczególną uwagę, czy serwer zwróci odpowiednią wartość parametru \texttt{key}, czyli \texttt{value\#}.} \
% ################################################################################################################# 
\item Spróbuj rozwiązać zadanie \ref{ex723} za pomocą narzędzia \texttt{curl}.  
% ################################################################################################################# 
\item \label{ex725} Korzystając z przygotowanego obrazu Dockerowego (\texttt{mazurkatarzyna/pas-book-p1-ch7-ex25:latest}), uruchom serwer HTTP.  Po uruchomieniu obrazu, pod adresem IPv4 \texttt{127.0.0.1} na porcie TCP o numerze \texttt{7025} działa serwer obsługujący protokół HTTP w wersji 1.1. Serwer w odpowiedzi na żądanie typu \texttt{GET} zwraca parametry żądania. Napisz program klienta, który połączy się z serwerem, a następnie wyśle do serwera żądanie \texttt{GET} z parametrem \texttt{key}, który jest tablicą, gdzie pierwszy element tablicy to \texttt{value1}, a drugi element tablicy to \texttt{value2}.  Następnie klient odbierze i wyświetli odpowiedź. Podczas pisania kodu związanego z operacjami sieciowymi, nie korzystaj z dodatkowych bibliotek, wykorzystaj jedynie gniazda. Zadbaj o prawidłową obsługę błędów.  
%\textit{Podpowiedź: Aby wysłać parametr jako tablicę, możesz użyć następującej składni:} \texttt{key[0]=value1\&key[1]=value2}.
% ################################################################################################################# 
\item Spróbuj rozwiązać zadanie \ref{ex725} bez użycia znaków \texttt{[} oraz \texttt{]}.
% ################################################################################################################# 
\item Spróbuj rozwiązać zadanie \ref{ex725} za pomocą narzędzia \texttt{curl}.  
% ################################################################################################################# 

% https://www.sidechannel.blog/en/http-method-override-what-it-is-and-how-a-pentester-can-use-it/


\end{enumerate}

\newpage 
\input{answers.tex}


\end{document}
